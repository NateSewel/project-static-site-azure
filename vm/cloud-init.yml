#cloud-config
package_update: true
package_upgrade: true
packages:
  - nginx
  - git

runcmd:
  - mkdir -p /var/www/html
  - rm -rf /var/www/html/*

  # Clone website repo with retries
  - |
    echo "Cloning website repo from GitHub..."
    for i in {1..5}; do
      git clone --depth 1 -b main https://github.com/NateSewel/project-static-site-azure.git /var/www/html && break || sleep 10
    done
    # Remove .git folder
    rm -rf /var/www/html/.git

  - chown -R www-data:www-data /var/www/html
  - systemctl enable nginx
  - systemctl restart nginx
  - echo "âœ… Cloud-init completed successfully"
  - echo "Your site should now be live on port 80."
