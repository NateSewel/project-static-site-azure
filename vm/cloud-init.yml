#cloud-config
package_update: true
package_upgrade: true
packages:
  - nginx
  - git

runcmd:
  - mkdir -p /var/www/html
  - rm -rf /var/www/html/*

  # Clone GitHub repo with retries
  - |
    for i in {1..5}; do
      echo "Cloning repo attempt $i..."
      git clone --depth 1 -b main https://github.com/NateSewel/project-static-site-azure.git /var/www/html && break
      echo "Clone failed, retrying in 30s..."
      sleep 30
    done
    rm -rf /var/www/html/.git || true

  - chown -R www-data:www-data /var/www/html
  - systemctl enable nginx
  - systemctl restart nginx
  - echo "âœ… Cloud-init completed successfully"
  - echo "Your site should now be live on port 80."
